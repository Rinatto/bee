import{initializeYandexMap}from"./yandexMap.js";import{startTimer,stopTimer}from"./timer.js";let pageCache={};function loadHTML(e,t){pageCache[e]?t(pageCache[e]):fetch(e).then((e=>e.text())).then((a=>{pageCache[e]=a,t(a)})).catch((e=>{console.error("Failed to load page: ",e),history.replaceState(null,null,"/bee/"),loadPageContent("index",!0)}))}document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelectorAll(".menu-element");e.forEach((e=>{e.addEventListener("click",(function(e){e.preventDefault(),loadPageContent(this.getAttribute("href").replace("/",""),!0)}))})),window.addEventListener("popstate",(t=>{t.state&&t.state.page?(loadPageContent(t.state.page,!1),function(t){e.forEach((e=>e.classList.remove("active-link")));const a=Array.from(e).find((e=>e.getAttribute("href").replace("/","")===t));a&&a.classList.add("active-link")}(t.state.page)):loadPageContent("activity",!1)}));const t=window.location.pathname.replace("/bee/","")||"index";["activity","map","timer","resume"].includes(t)?loadPageContent(t,!1):(history.replaceState(null,null,"/bee/"),loadPageContent("index",!1))}));export function loadPageContent(e,t=!0){const a={activity:"activity.html",map:"map.html",timer:"timer.html",resume:"resume.html"}[e];if(!a)return console.error("Unknown page:",e),history.replaceState(null,null,"/bee/"),void loadPageContent("index",!0);"timer"!==e&&stopTimer();let n=null;"map"===e?n=initializeYandexMap:"timer"===e&&(n=startTimer),loadHTML(`/bee/${a}`,(e=>{document.querySelector(".main").innerHTML=e,n&&n()})),t&&history.pushState({page:e},null,`/bee/${e}`),setActiveLink(e)}